---
subtitle: "Aprendizaje Estad√≠stico -  (84:04)"
author: 'Alejandro Verri Kozlowski'
title: 'Pr√°ctica 3'
output:
  bookdown::gitbook: 
    number_sections: no
  pdf_document:
    toc: no
    number_sections: no
    latex_engine: xelatex
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source("R/setup.R", local = TRUE)
```

# Pr√°ctica 3 - Parte 1
## Ejercicio 1

Implementar una funci√≥n que dado un vector `y` de valores de respuesta y una matriz `X` de valores observados, mediante las ecuaciones normales, calcule el estimador de cuadrados m√≠nimos



## Ejercicio 2

Se tiene en el archivo `girasol.txt` el rinde de diversas parcelas de girasol (en toneladas) seg√∫n la
cantidad de dinero invertida en fertilizantes (en miles de pesos).

a Graficar en un diagrama de dispersi√≥n inversi√≥n vs rinde.
b. Plantear un modelo de regresi√≥n lineal simple obtener el estimador de mƒ±ÃÅnimos cuadrados.
c. Graficar la recta de regresi√≥n obtenida, ¬ødetecta algo sospechoso?

## Ejercicio 3

Considerar el archivo abalone.txt que contiene informaci√≥n sobre distintas muestras de abalones. Los atributos est√°n separados por coma, con los siguientes campos: 

- Sexo (categ√≥rica): M (masculino), F (femenino) o I (infante).
- Longitud (continua), en milimetros.
- Diametro (continua), en milimetros.
- Altura (continua), en milimetros.
- Peso completo del abalone (continua), en gramos.
- Peso de la carne (continua), en gramos.
- Peso de las v√≠sceras (continua), en gramos.
- Peso del caparaz√≥n (continua), en gramos.
- Anillos (discreta).

a. Plantear un modelo de regresi√≥n lineal simple para predecir el di√°metro en funci√≥n de la longitud.

b. Observar que el conjunto de datos tiene informaci√≥n del peso total de cada esp√©cimen junto con un desagregado por partes. Ajustar un modelo de regresi√≥n m√∫ltiple que explique el peso total en funci√≥n del peso del caparaz√≥n, las vƒ±ÃÅsceras y la carne.

c. Se trata ahora de establecer una relaci√≥n entre el peso total y el di√°metro del esp√©cimen. Empezar dibujando en un scatter plot ambas variables. Si definimos como `P` al peso total y `D` al di√°metro, se consideran los siguientes modelos:

- Modelo lineal simple, $P = b + a\.D + \varepsilon$

- Modelo cuadr√°tico, $P = c + b\.D + a\.D^2 + \varepsilon$

- Modelo cubico sin t√©rminos de orden inferior, $P = a\.D^3 + $\varepsilon$

Efectuar en cada caso una regresi√≥n y graficar las curvas superpuestas sobre el scatter plot.


## Ejercicio 4
En este ejercicio se crear√°n datos simulados y se ajustar√° un modelo de regresi√≥n lineal simple.
 
a) Utilizando la funci√≥n rnorm, crear un vector x que contenga 100 observaciones provenientes de una distribuci√≥n $X \sim \mathcal{N}(\mu=0,\,\sigma=1)$
  
```{r echo=TRUE}
X <- rnorm(n=100,mean=0,sd=1)
```
  
b) Utilizando la funci√≥n rnorm, crear un vector epsilon que contenga 100 observaciones provenientes de una distribuci√≥n $\Sigma \sim \mathcal{N}(\mu=0,\sigma=0.025)$
   

```{r echo=TRUE}
e <- rnorm(n=100,mean=0,sd=0.025)
```
   
   
c) Usando $x$ y $\varepsilon$, generar un vector acorde al modelo: $y = ‚àí1 + 0.5 x + \varepsilon$. ¬øCu√°l es la longitud del vector y? ¬øCu√°les son los valores de $\beta_0$ y $\beta_1$ en el modelo?
  
  
```{r echo=TRUE}
Y <- -1 + 0.5*X +e
```
_La longitud del vector `y=-1+0.5*x+e` es igual a 100  ya que fue construido como la suma de dos vectores de 100 elementos, y adem√°s R tiene sobrecargado el operador suma y permite agregar la constante `1` a cada elemento del vector. Los par√°metros $\beta_0$ y $\beta_1$ del modelo son en este caso $\beta_0=-1$ y $\beta_1=+0.5$_  
  
  d) Realizar un scatterplot y observar la relaci√≥n entre x e y.
  
```{r }
DT <- data.table(x=X,y=Y)
ggplot(data=DT, aes(x=x, y=y)) + geom_point(color="tomato") + theme_bw()
```
  
e) Ajustar un modelo lineal para predecir y en funci√≥n de x utilizando el m√©todo de cuadrados mƒ±ÃÅnimos.

```{r echo=TRUE}
DT <- data.table(x=X,y=Y)
MDL <- lm(data=DT,y~1+x)
b0 <- MDL$coefficients["(Intercept)"]
b1 <- MDL$coefficients["x"]
```

Comparar los valores exactos de $\beta_0$ Y $\beta_1$ con sus estimaciones. 
```{r}
data.table("\\beta_0"=-1,"\\hat{\\beta_0}"=b0,"\\beta_1"=0.5,"\\hat{\\beta_1}"=b1) |> 
  flextable() |> 
  colformat_double(j = 4, digits = 8) |> 
  mk_par(i = 1, part = "header",
         value = as_paragraph(
           as_equation(.,width = .1, height = .2)),
         use_dot = TRUE) |>  
  autofit()
```
 
_Los estimadores de $\beta_0$ y $\beta_1$ resultaron $\hat{\beta_0}\approx$ `r b0` y $\hat{\beta_1}\approx$ `r b1`, respectivamente_
  
f) Graficar la recta de cuadrados mƒ±ÃÅnimos sobre el gr√°fico realizado en (d). En otro color graficar la recta Y = ‚àí1 + 0,5X. 

```{r }
DT <- data.table(x=X,y=Y)
DTP <- data.table(x=X,y=b0+b1*X)
B0 <- -1
B1 <- 0.5

ggplot() + geom_point(data=DT, aes(x=x, y=y),color="tomato") + geom_line(data=DTP,aes(x=x, y=y),color="red")+ geom_abline(intercept = B0,slope = B1,color="blue") + theme_bw()
```
_Las lineas son pr√°cticamente id√©nticas y no hay manera de diferenciarlas, tal como se vio en la comparaci√≥n de los coeficientes_


g) Ajustar un modelo polinomial que prediga y usando x y x 2 . 

```{r echo=TRUE}
DT <- data.table(y=Y,x1=X,x2=X^2)
MDL <- lm(data=DT,y~x1+x2)
b0 <- MDL$coefficients["(Intercept)"]
b1 <- MDL$coefficients["x1"]
b2 <- MDL$coefficients["x2"]
```
_Los estimadores de $\beta_0$ y $\beta_1$ ahora resultan en  $\hat{\beta_0}\approx$ `r b0` y $\hat{\beta_1}\approx$ `r b1` respectivamente y se agrega un tercer estimador para el t√©rmino cuadr√°tico igual a $\hat{\beta_2}\approx$ `r b2`. _

```{r}
data.table("\\beta_0"=-1,"\\hat{\\beta_0}"=b0,"\\beta_1"=0.5,"\\hat{\\beta_1}"=b1) |> 
  flextable() |> 
  colformat_double(j = 4, digits = 8) |> 
  mk_par(i = 1, part = "header", value = as_paragraph(as_equation(.,width = .1, height = .2)),use_dot = TRUE) |>  
  autofit()
```


  ¬øEncuentra alguna evidencia de que el t√©rmino cuadr√°tico mejora el ajuste del modelo? 

_No, los estimadores $\hat{\beta_0}\approx$ `r b0` y $\hat{\beta_1}\approx$ `r b1` pr√°cticamente no difieren de los anteriores._

h) Repetir los ƒ±ÃÅtems (a) a (f) modificando los datos generados de manera que haya menos ruido en los datos. Una forma de hacerlo es disminuyendo el valor de la varianza de la distribuci√≥n normal usada para general el t√©rmino del error epsilon. 

```{r }
# 
Y <- -1 + 0.5*X + 3*e
DT <- data.table(x=X,y=Y)
MDL <- lm(data=DT,y~1+x)
b0 <- MDL$coefficients["(Intercept)"]
b1 <- MDL$coefficients["x"]
DTP <- data.table(x=X,y=b0+b1*X)
B0 <- -1
B1 <- 0.5

ggplot() + geom_point(data=DT, aes(x=x, y=y),color="plum") + geom_line(data=DTP,aes(x=x, y=y),color="salmon")+ geom_abline(intercept = B0,slope = B1,color="blue") + theme_bw()
```


i) Repetir los ƒ±ÃÅtems (a) a (f) modificando los datos generados de manera que haya m√°s ruido en los datos. Una forma de hacerlo es aumentando el valor de la varianza de la distribuci√≥n normal usada para general el t√©rmino del error epsilon. 

```{r }
DT1 <- data.table(x=X,y=Y)
DT2 <- data.table(x=X,y=b0+b1*X)
B0 <- -1
B1 <- 0.5

ggplot() + geom_point(data=DT1, aes(x=x, y=y),color="tomato") + geom_line(data=DT2,aes(x=x, y=y),color="red")+ geom_abline(intercept = B0,slope = B1,color="blue") + theme_bw()
```


j) En ambos escenarios, hallar una estimaci√≥n de la varianza. 

## Ejercicio 5

a) Generar el siguiente modelo: Crear dos vectores de datos de tama√±o 100 x 1 y x 2 a partir de una distribuci√≥n uniforme en el intervalo (0, 1). 

Crear el vector y = 2 + 2 ‚àó x 1 + 0,3 ‚àó x 2 + , con  que contenga 100 observaciones provenientes de una distribuci√≥n N (0, 1). ¬øCuales son los coeficientes de regresi√≥n?. Estimar la correlaci√≥n entre x 1 y x 2 .

Realizar un scatterplot en el que pueda observarse la relaci√≥n entre x 1 y x 2 . Utilizando los datos generados, ajustar a un modelo lineal para predecir y en funci√≥n de x 1 y x 2 , utilizando el m√©todo de cuadrados mƒ±ÃÅnimos y comparar los valores exactos de Œ≤ con sus valores estimados
    
b) Repetir el inciso a pero con el siguiente modelo: Crear dos vectores de datos de tama√±o 100 x 1 a partir de una distribuci√≥n uniforme en el intervalo (0, 1), y x 2 = 0,5 ‚àó x 1 + rnorm(100)/10 . Crear el vector y = 2 + 2 ‚àó x 1 + 0,3 ‚àó x 2 + rnorm(100). Comparar los resultados obtenidos con los del ƒ±ÃÅtem a. 
    
    
